# ============================================================
# Openinary Railway Template - Deploy Configuration
# https://docs.railway.com/reference/config-as-code
# ============================================================

[build]
# Use Dockerfile as the build source
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
# No startCommand — the base image (openinary/openinary) handles its own CMD.
# Overriding CMD caused conflicts with supervisord startup.

# Number of replicas
numReplicas = 1

# Health check — Railway hits this path and expects a 2xx response.
# Give 5 minutes for supervisord to bring up Nginx + API + Web UI.
healthcheckPath = "/"
healthcheckTimeout = 300

# Restart policy: restart on failure, up to 3 times
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# ============================================================
# Persistent Volume
# Stores the SQLite database: admin accounts, API keys, metadata.
# Without this volume, all data is lost on every redeploy.
# ============================================================
[[volumes]]
  name = "openinary-db"
  mountPath = "/app/data"
